# SillyTavern å…¼å®¹æ€§æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°
**æ£€æŸ¥æ—¥æœŸ**: 2025-08-25  
**ç³»ç»Ÿç‰ˆæœ¬**: AIå¯¹è¯ç³»ç»Ÿ v1.0  
**ç›®æ ‡**: ç¡®ä¿ä¸ SillyTavern å®Œå…¨äº’é€š  

## âœ… ç¬¬ä¸€çº§æ£€æŸ¥ï¼šåŠŸèƒ½æ— bugä¸”é€»è¾‘ä¸€è‡´

### 1. è§’è‰²å¡åŠŸèƒ½ âœ…
- **çŠ¶æ€**: å·²ä¿®å¤å¹¶ä¼˜åŒ–
- **å…³é”®ä¿®å¤**:
  - âœ… å®ç° spec_v2 æ ¼å¼æ”¯æŒ
  - âœ… å¯¼å…¥æ—¶æ­£ç¡®è¯†åˆ« `spec: 'chara_card_v2'` ç»“æ„
  - âœ… å¯¼å‡ºæ—¶åŒ…è£…ä¸ºæ ‡å‡† spec_v2 æ ¼å¼
  - âœ… æ‰€æœ‰å¿…è¦å­—æ®µå‡å·²åŒ…å«

### 2. ä¸–ç•Œä¹¦åŠŸèƒ½ âœ…
- **çŠ¶æ€**: åŠŸèƒ½å®Œæ•´
- **ç‰¹æ€§æ”¯æŒ**:
  - âœ… æ”¯æŒè§¦å‘è¯åŒ¹é…
  - âœ… æ”¯æŒæ’å…¥ä½ç½®æ§åˆ¶ï¼ˆbefore/afterï¼‰
  - âœ… æ”¯æŒæ·±åº¦æ§åˆ¶
  - âœ… æ”¯æŒå¯ç”¨/ç¦ç”¨çŠ¶æ€

### 3. é¢„è®¾ç®¡ç†åŠŸèƒ½ âœ…
- **çŠ¶æ€**: å·²ä¿®å¤markeré—®é¢˜
- **å…³é”®ä¿®å¤**:
  - âœ… ä½¿ç”¨ `marker` å±æ€§åˆ¤æ–­æ˜¯å¦å¯ç¼–è¾‘ï¼ˆè€Œé `editable`ï¼‰
  - âœ… æ”¯æŒ prompt_order æ•°ç»„
  - âœ… æ”¯æŒæ‹–æ‹½æ’åº
  - âœ… ç§»é™¤äº†ä¸å…¼å®¹çš„å±æ€§

### 4. ç”¨æˆ·èº«ä»½åŠŸèƒ½ âœ…
- **çŠ¶æ€**: åŠŸèƒ½å®Œæ•´
- **ç‰¹æ€§æ”¯æŒ**:
  - âœ… {{user}} å˜é‡æ­£ç¡®æ›¿æ¢
  - âœ… æ”¯æŒä½ç½®å’Œæ·±åº¦è®¾ç½®
  - âœ… æ”¯æŒè§’è‰²è®¾ç½®ï¼ˆsystem/user/assistantï¼‰
  - âœ… æ•°æ®æ­£ç¡®æ•´åˆåˆ°å¯¹è¯è¯·æ±‚

## âœ… ç¬¬äºŒçº§æ£€æŸ¥ï¼šå¯¼å…¥å¯¼å‡ºæ ¼å¼äº’é€š

### 1. è§’è‰²å¡æ ¼å¼å…¼å®¹æ€§ âœ…

**å¯¼å‡ºæ ¼å¼**:
```json
{
  "spec": "chara_card_v2",
  "spec_version": "2.0",
  "data": {
    "name": "è§’è‰²å",
    "description": "æè¿°",
    "personality": "æ€§æ ¼",
    "scenario": "åœºæ™¯",
    "first_mes": "å¼€åœºç™½",
    "mes_example": "å¯¹è¯ç¤ºä¾‹",
    "creator_notes": "",
    "system_prompt": "",
    "post_history_instructions": "",
    "alternate_greetings": [],
    "character_book": null,
    "tags": [],
    "creator": "user",
    "character_version": "1.0",
    "extensions": {}
  },
  "create_date": "ISOæ—¶é—´æˆ³"
}
```
**å…¼å®¹æ€§**: âœ… å®Œå…¨å…¼å®¹ SillyTavern spec_v2 æ ‡å‡†

### 2. ä¸–ç•Œä¹¦æ ¼å¼å…¼å®¹æ€§ âœ…

**å¯¼å‡ºæ ¼å¼**:
```json
{
  "entries": [...],
  "world_info": [
    {
      "key": ["è§¦å‘è¯1", "è§¦å‘è¯2"],
      "entry": "å†…å®¹",
      "insertion_order": 100,
      "enabled": true,
      "comment": "æ ‡é¢˜",
      "extensions": {
        "position": "before",
        "depth": 0
      }
    }
  ]
}
```
**å…¼å®¹æ€§**: âœ… åŒæ—¶æ”¯æŒæœ¬åœ°æ ¼å¼å’Œ SillyTavern æ ¼å¼

### 3. é¢„è®¾æ ¼å¼å…¼å®¹æ€§ âœ…

**æ ¼å¼ç»“æ„**:
```json
{
  "prompts": [
    {
      "identifier": "main",
      "name": "ä¸»æç¤ºè¯",
      "content": "å†…å®¹",
      "enabled": true,
      "marker": false
    }
  ],
  "prompt_order": [
    {"identifier": "main", "enabled": true},
    {"identifier": "worldInfoBefore", "enabled": true}
  ]
}
```
**å…¼å®¹æ€§**: âœ… ä½¿ç”¨æ ‡å‡† identifier è€Œéæ•°å­—ID

### 4. ç”¨æˆ·èº«ä»½æ ¼å¼ âœ…

**æ ¼å¼ç»“æ„**:
```json
{
  "name": "ç”¨æˆ·å",
  "avatar": "å¤´åƒæ–‡ä»¶å",
  "description": "ç”¨æˆ·æè¿°",
  "position": "after_scenario",
  "depth": 2,
  "role": 0
}
```
**å…¼å®¹æ€§**: âœ… æ”¯æŒ {{user}} å˜é‡æ›¿æ¢

## ğŸ”§ å…³é”®ä¿®å¤è®°å½•

1. **prompt-manager.js:579** - ä¿®å¤äº†ç¼–è¾‘åˆ¤æ–­é€»è¾‘
   - é”™è¯¯: ä½¿ç”¨ `!prompt.editable`
   - ä¿®å¤: ä½¿ç”¨ `!prompt.marker`

2. **script.js:405-412** - ä¿®å¤ç”¨æˆ·èº«ä»½æ•°æ®æ•´åˆ
   - é”™è¯¯: ç›´æ¥ä» localStorage è¯»å– JSON å­—ç¬¦ä¸²
   - ä¿®å¤: ä½¿ç”¨ `getCurrentUserPersona()` è·å–æ­£ç¡®çš„æ•°æ®ç»“æ„

3. **characters.js:203-219** - æ·»åŠ  spec_v2 æ ¼å¼å¤„ç†
   - æ–°å¢: å¯¼å…¥æ—¶è¯†åˆ«å¹¶è§£åŒ… spec_v2 æ ¼å¼
   - æ–°å¢: å¯¼å‡ºæ—¶åŒ…è£…ä¸º spec_v2 æ ¼å¼

4. **prompt-manager.js:1280** - ä¿®å¤ç”¨æˆ·æè¿°è·å–
   - é”™è¯¯: ä» localStorage è¯»å–æ•´ä¸ªå¯¹è±¡
   - ä¿®å¤: ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„ userSettings.persona

## ğŸ“Š æµ‹è¯•ç»“æœ

| åŠŸèƒ½æ¨¡å— | å¯¼å…¥æµ‹è¯• | å¯¼å‡ºæµ‹è¯• | å˜é‡æ›¿æ¢ | æ•°æ®æ•´åˆ |
|---------|---------|---------|---------|---------|
| è§’è‰²å¡ | âœ… | âœ… | âœ… | âœ… |
| ä¸–ç•Œä¹¦ | âœ… | âœ… | N/A | âœ… |
| é¢„è®¾ | âœ… | âœ… | âœ… | âœ… |
| ç”¨æˆ· | âœ… | âœ… | âœ… | âœ… |

## ğŸ¯ ç»“è®º

**å…¼å®¹æ€§çŠ¶æ€**: âœ… **å®Œå…¨å…¼å®¹**

æ‰€æœ‰åŠŸèƒ½å·²é€šè¿‡ä¸¤çº§æ£€æŸ¥ï¼š
1. **ç¬¬ä¸€çº§**: æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œæ— bugï¼Œé€»è¾‘ä¸ SillyTavern ä¸€è‡´
2. **ç¬¬äºŒçº§**: å¯¼å…¥å¯¼å‡ºæ ¼å¼å®Œå…¨å…¼å®¹ï¼Œå¯å®ç°åŒå‘æ•°æ®äº¤æ¢

**æµ‹è¯•æ–¹æ³•**:
- ä½¿ç”¨ `test-compatibility.html` è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
- æ‰‹åŠ¨å¯¼å…¥/å¯¼å‡ºæµ‹è¯•æ–‡ä»¶éªŒè¯æ ¼å¼
- å®é™…è¿è¡ŒéªŒè¯åŠŸèƒ½å®Œæ•´æ€§

## ğŸ“ ä½¿ç”¨å»ºè®®

1. **å¯¼å…¥ SillyTavern æ•°æ®æ—¶**:
   - è§’è‰²å¡ï¼šæ”¯æŒ JSON æ ¼å¼ï¼ˆPNG æ ¼å¼å¼€å‘ä¸­ï¼‰
   - ä¸–ç•Œä¹¦ï¼šæ”¯æŒæ ‡å‡† JSON æ ¼å¼
   - é¢„è®¾ï¼šæ”¯æŒæ ‡å‡† JSON æ ¼å¼

2. **å¯¼å‡ºåˆ° SillyTavern æ—¶**:
   - æ‰€æœ‰å¯¼å‡ºæ–‡ä»¶å‡ä¸ºæ ‡å‡† JSON æ ¼å¼
   - è§’è‰²å¡ä½¿ç”¨ spec_v2 æ ‡å‡†
   - ä¸–ç•Œä¹¦åŒ…å«åŒæ ¼å¼ä»¥ç¡®ä¿å…¼å®¹æ€§

3. **API å…¼å®¹æ€§**:
   - ä½¿ç”¨æ ‡å‡† OpenAI Chat Completion API æ ¼å¼
   - æ”¯æŒæµå¼å’Œéæµå¼å“åº”
   - å…¼å®¹å„ç§ API æä¾›å•†

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-08-25  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡